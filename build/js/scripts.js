"use strict";function openModal(){$(".theater-modal").modal("show")}function getCurrentDay(){var e=new Date,t=e.getDate(),a=e.getMonth()+1,n=e.getFullYear();return 10>t&&(t="0"+t),10>a&&(a="0"+a),e=t+"-"+a+"-"+n}function copyToClipboard(){var e=$("<input>");$("body").append(e),console.log(),e.val($("#copy").val()).select(),document.execCommand("copy"),e.remove()}function getSelectedDate(e){if(e){var t=e,a=t.split("-"),n=new Date(Number(a[2]),Number(a[1])-1,Number(a[0]));if(new Date(n)>new Date)return t}return getCurrentDay()}function getIndexByAlias(e,t){var a=-1;return $.each(e,function(e,n){return n.alias==t?(a=e,!1):void 0}),a}var patheApp=angular.module("patheApp",["ngRoute","ngCookies","patheControllers","patheServices","angular-owl-carousel"]);patheApp.config(["$routeProvider","$locationProvider",function(e,t){e.when("/home",{templateUrl:"pages/home.html",controller:"HomeCtrl"}).when("/planning/:id",{templateUrl:"pages/result.html",controller:"ResultCtrl"}).when("/planning/:id/:index",{templateUrl:"pages/result.html",controller:"ResultCtrl"}).when("/planning",{templateUrl:"pages/result.html",controller:"ResultCtrl"}).otherwise({redirectTo:"/home"}),t.html5Mode({enabled:!0,requireBase:!1})}]);var BASE_URL="http://localhost/Patheplanner/",MAX_MOVIE_AMOUNT=5,DEFAULT_THEATERS=[{id:11,name:"PathÃ© Spuimarkt",alias:"spuimarkt",city:"Den Haag",city_alias:"denhaag",selected:!0}],patheControllers=angular.module("patheControllers",[]);patheControllers.controller("HomeCtrl",["$scope","$location","$cookies","patheService",function(e,t,a,n){e.selectedDate=getSelectedDate(a.get("day")),e.selectedTheaters=a.get("theaters")?JSON.parse(a.get("theaters")):DEFAULT_THEATERS,e.selectedMovies=[],n.getDays().success(function(t){e.days=t}),n.getTheaters().success(function(t){var a=e.setSelectedTheaters(t);e.theaters=a}),e.setSelectedTheaters=function(t){return $.each(t,function(t,a){$.each(a,function(t,a){var n=getIndexByAlias(e.selectedTheaters,a.alias);n>-1&&(a.selected=!0)})}),t},e.getMovies=function(){if(e.selectedTheaters.length>0){e.loading=!0,e.movies=[],e.selectedMovies=[];var t={date:e.selectedDate,theaters:e.selectedTheaters};n.getMovies(t).success(function(t){e.movies=t,e.loading=!1})}},e.selectDate=function(t){e.selectedDate=t,a.put("day",t)},e.selectTheater=function(t){var a=getIndexByAlias(e.selectedTheaters,t.alias);-1==a?(e.selectedTheaters.length>0&&e.selectedTheaters[0].city_alias!=t.city_alias&&($(".ui.checkbox input:checked."+e.selectedTheaters[0].city_alias).click(),e.selectedTheaters=[]),e.selectedTheaters.push(t)):e.selectedTheaters.splice(a,1)},e.saveSelectedTheaters=function(){e.selectedTheaters.length>0&&(a.put("theaters",JSON.stringify(e.selectedTheaters)),$(".theater-modal").modal("hide"),e.getMovies())},e.selectMovie=function(t){var a=e.selectedMovies.indexOf(t),n=e.selectedMovies.length;-1==a?MAX_MOVIE_AMOUNT>n&&(e.selectedMovies.push(t),$(".item-"+t.id).addClass("selected")):(e.selectedMovies.splice(a,1),$(".item-"+t.id).removeClass("selected"))},e.makePlanning=function(){$(".planning-modal").modal("setting","closable",!1).modal("show");var a={theaters:e.selectedTheaters,date:e.selectedDate,movies:e.selectedMovies};n.makePlanning(a).success(function(e){var a=e;t.path("planning/"+a),$(".planning-modal").modal("hide")})},e.$watch("selectedDate",function(){e.getMovies()}),$(".page.modals").remove()}]),patheControllers.controller("ResultCtrl",["$scope","$routeParams","$timeout","patheService",function(e,t,a,n){e.id=t.id,e.index=t.index?t.index-1:0,e.baseUrl=BASE_URL,e.loading=!0,n.getResult(e.id).success(function(t){e.loading=!1,t.data&&(e.items=JSON.parse(t.data),e.selectedItem=e.items[e.index],$(".planning.dropdown").dropdown(),a(function(){angular.element(".planning.dropdown #planning-"+e.index).trigger("click")},0))}),e.setPlanning=function(t){e.selectedItem=e.items[t],e.index=t}}]);var patheServices=angular.module("patheServices",[]),urlBase="http://localhost/Patheplanner/app";patheServices.factory("patheService",["$http",function(e){var t={};return t.getDays=function(){return e.get(urlBase+"/getDays")},t.getTheaters=function(){return e.get(urlBase+"/getTheaters")},t.getMovies=function(t){return e.post(urlBase+"/getMovies",t)},t.makePlanning=function(t){return e.post(urlBase+"/makePlanning",t)},t.getResult=function(t){return e.get(urlBase+"/getResult/"+t)},t}]),function(e){e("html, body"),e(".movies").smoothState()}(jQuery);